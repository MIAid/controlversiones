<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Herramientas de APP</title> <!-- Título principal unificado -->
    
    <!-- Tailwind CSS CDN (usado por la calculadora NOSIS, lo incluimos una vez) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* Estilos generales de la página (adaptados de tu primer código) */
        body {
            font-family: 'Inter', Arial, sans-serif; /* Prioriza Inter, fallback Arial */
            margin: 0;
            padding: 0;
            text-align: center;
            position: relative;
            min-height: 100vh;
            overflow-x: hidden;
            transition: background-image 1s ease-in-out;
            display: flex; /* Usamos flexbox para centrar y organizar las secciones */
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; /* Alinea al inicio, permitiendo el scroll */
            padding-bottom: 50px; /* Espacio para el footer */
        }

        /* Título principal de la aplicación */
        h1 {
            font-size: 40px;
            background: linear-gradient(10deg, #3e4b75 40%, #ff5722 40%, #ffeb3b 70%);
            color: transparent;
            -webkit-background-clip: text;
            background-clip: text;
            margin-top: 20px;
            margin-bottom: 30px;
        }

        /* Contenedor del menú inicial */
        #main-menu {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 50px;
            align-items: center;
            justify-content: center;
            height: calc(100vh - 150px); /* Ajusta para centrar en la pantalla inicial */
            width: 100%;
            max-width: 600px;
            padding: 20px;
            box-sizing: border-box;
        }

        #main-menu button {
            background-color: #4CAF50; /* Color verde */
            color: white;
            padding: 15px 30px;
            font-size: 24px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s;
            width: 80%; /* Ancho de los botones del menú */
            max-width: 400px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        #main-menu button:hover {
            background-color: #45a049;
            transform: translateY(-3px);
        }

        /* Estilos de las secciones de contenido (inicialmente ocultas) */
        .content-section {
            display: none; /* Oculta todas las secciones por defecto */
            width: 100%; /* Ocupa el ancho completo */
            padding: 20px 0; /* Ajusta padding */
            box-sizing: border-box;
        }

        /* === Estilos de la sección "Verificar versiones de APP" === */
        .app-versions-section {
            background-color: transparent; /* El fondo lo maneja el body */
            padding-top: 0;
            padding-bottom: 0;
        }

        .app-card {
            background-color: white;
            margin: 10px;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(249, 247, 247, 0.1);
            display: inline-flex; /* Cambiado a inline-flex para centrar contenido */
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            width: 180px;
            text-align: center;
            box-sizing: border-box;
            vertical-align: top; /* Alineación para inline-block/flex */
        }

        .app-card h2 {
            color: #333;
            font-size: 18px;
            margin-bottom: 15px;
        }

        .app-card .button-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 100%;
            margin-top: 15px;
        }

        .app-card button {
            border: none;
            padding: 10px 15px;
            font-size: 14px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s;
            color: white;
            width: 100%;
        }

        .mia-button { background-color: #ff5722; }
        .ponal-button { background-color: #207f00; }
        .osecac-button { background-color: #3136ce; }
        .hooli-button { background-color: #f6ff00; color: #333; }
        .rn-hooli-button { background-color: #008149; }
        .optimize-button { background-color: #7B68EE; }

        .app-card button:hover {
            opacity: 0.8;
            transform: translateY(-2px);
        }

        .apps-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
            overflow-x: auto;
            padding: 0 10px;
        }

        .app-card img {
            width: 100%;
            max-width: 120px;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(246, 244, 244, 0.1);
            margin-bottom: 15px;
        }

        /* === Contenedor para el logo (footer) === */
        .logo-container {
            text-align: center;
            margin-top: 40px;
            position: relative;
            padding-bottom: 20px;
            width: 100%; /* Asegura que el footer ocupe todo el ancho */
        }

        .logo-container h3, .logo-container p {
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(50deg, #ffffff, #ffffff, #fffffd);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
        }

        .logo-container p {
            font-size: 16px;
            font-weight: normal;
        }

        .clock {
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(120deg, hsl(232, 100%, 50%), #ff6a00, #ffeb3b);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-top: 20px;
            margin-bottom: 30px;
        }

        .daytime h3, .daytime p { text-shadow: 1px 1px 3px rgba(255, 255, 255, 0.8); }
        .nighttime h3, .nighttime p { text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7); }

        /* === Estilos de las secciones de características LLM (compartidas) === */
        .llm-feature-section {
            background-color: #e0f2f7;
            padding: 30px 20px;
            margin-top: 40px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            width: 100%; /* Asegura que ocupe el ancho máximo del contenedor */
            box-sizing: border-box; /* Incluye padding en el ancho */
        }
        .llm-feature-section textarea { resize: vertical; min-height: 80px; }
        .llm-feature-section .loading-spinner {
            border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%;
            width: 24px; height: 24px; animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .llm-feature-section ul { list-style-type: disc; padding-left: 20px; text-align: left;} /* Ajuste de lista */

        /* === Estilos específicos para la Calculadora NOSIS === */
        .nosis-calculator-section {
            background-color: #f0f4f8;
            padding: 40px 20px;
            margin-top: 40px;
            margin-bottom: 40px;
            border-top: 1px solid #e0e0e0;
            border-bottom: 1px solid #e0e0e0;
        }
        .nosis-calculator-section .container { /* Reutiliza la clase container de Tailwind */
            max-width: 800px; width: 100%; background-color: #ffffff; border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1); padding: 30px; box-sizing: border-box;
            margin-left: auto; margin-right: auto;
        }
        .nosis-calculator-section textarea { resize: vertical; min-height: 120px; }
        .nosis-calculator-section input[type="number"] { -moz-appearance: textfield; }
        .nosis-calculator-section input[type="number"]::-webkit-outer-spin-button,
        .nosis-calculator-section input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        
        /* === Estilos para el modal === */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.6); display: flex; justify-content: center; align-items: center;
            z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal.open { opacity: 1; visibility: visible; }
        .modal-content {
            background-color: #fff; padding: 25px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            width: 90%; max-width: 500px; position: relative; transform: translateY(-20px); transition: transform 0.3s ease;
        }
        .modal.open .modal-content { transform: translateY(0); }
        .modal-close-btn {
            position: absolute; top: 10px; right: 15px; font-size: 24px; cursor: pointer;
            border: none; background: none; color: #555;
        }
        .modal-close-btn:hover { color: #333; }
    </style>
</head>
<body>
    <!-- Menú Principal (Inicialmente visible) -->
    <div id="main-menu">
        <h1>Selecciona una Opción</h1>
        <button id="show-versions-btn">Consultar Versiones de APP</button>
        <button id="show-nosis-btn">Consultar NOSIS</button>
    </div>

    <!-- Sección 1: Verificar las versiones de las APP (Inicialmente oculta) -->
    <div id="app-versions-section" class="content-section app-versions-section">
        <h1>Verificar las versiones de las APP</h1>

        <!-- Contenedor del reloj -->
        <div class="clock" id="clock"></div>

        <!-- Contenedor de botones de las APP -->
        <div class="apps-container">
            <!-- MIA -->
            <div class="app-card">
                <img src="https://play-lh.googleusercontent.com/l_J0UhLRYnzgBC_BjWmr05EmYcoa3YrW_E3YpXNX9LquIKpY-cIXt5Iu2piRz-zSLQ=w480-h960-rw" alt="Imagen de MIA">
                <h2>MIA</h2>
                <div class="button-group">
                    <a href="https://play.google.com/store/apps/details?id=me.miaid.wallet&hl=es_AR" target="_blank">
                        <button class="mia-button">Verificar versión</button>
                    </a>
                    <button class="generate-summary-btn mia-button" data-app-name="MIA" data-app-url="https://play.google.com/store/apps/details?id=me.miaid.wallet&hl=es_AR">Generar Resumen ✨</button>
                    <button class="optimize-app-btn mia-button optimize-button" data-app-name="MIA" data-app-url="https://play.google.com/store/apps/details?id=me.miaid.wallet&hl=es_AR">Optimizar APP ✨</button>
                </div>
            </div>

            <!-- PONAL -->
            <div class="app-card">
                <img src="https://play-lh.googleusercontent.com/9p-H8KJPah3i3fSXvcRwRihMxUPFZmg606VRpEUeYOmH9mPLU3ag9otNue0fs17QiQ=w480-h960-rw" alt="Imagen de PONAL">
                <h2>PONAL</h2>
                <div class="button-group">
                    <a href="https://play.google.com/store/apps/details?id=me.miaid.ponalmia&hl=es_AR" target="_blank">
                        <button class="ponal-button">Verificar versión</button>
                    </a>
                    <button class="generate-summary-btn ponal-button" data-app-name="PONAL" data-app-url="https://play.google.com/store/apps/details?id=me.miaid.ponalmia&hl=es_AR">Generar Resumen ✨</button>
                    <button class="optimize-app-btn ponal-button optimize-button" data-app-name="PONAL" data-app-url="https://play.google.com/store/apps/details?id=me.miaid.ponalmia&hl=es_AR">Optimizar APP ✨</button>
                </div>
            </div>

            <!-- OSECAC -->
            <div class="app-card">
                <img src="https://play-lh.googleusercontent.com/Saeph7Dkkft4UV_x7fX_cS6AsOdR38iqAPvV7iF6gXklTmITofvORWmsrzPvei71ww=w480-h960-rw" alt="Imagen de OSECAC">
                <h2>OSECAC</h2>
                <div class="button-group">
                    <a href="https://play.google.com/store/apps/details?id=me.miaid.osecac&hl=es_AR&pli=1" target="_blank">
                        <button class="osecac-button">Verificar versión</button>
                    </a>
                    <button class="generate-summary-btn osecac-button" data-app-name="OSECAC" data-app-url="https://play.google.com/store/apps/details?id=me.miaid.osecac&hl=es_AR&pli=1">Generar Resumen ✨</button>
                    <button class="optimize-app-btn osecac-button optimize-button" data-app-name="OSECAC" data-app-url="https://play.google.com/store/apps/details?id=me.miaid.osecac&hl=es_AR&pli=1">Optimizar APP ✨</button>
                </div>
            </div>

            <!-- hooli -->
            <div class="app-card">
                <img src="https://play-lh.googleusercontent.com/qb_Xf_BkIGz1IShB6yqwLxdAAZyqXhYWPd8NdpM4QwZ5DDpiPnE_EUQFe8PGegidjA=s96-rw" alt="Imagen de hooli">
                <h2>hooli</h2>
                <div class="button-group">
                    <a href="https://play.google.com/store/apps/details?id=net.airata.hooli.app&hl=es_AR" target="_blank">
                        <button class="hooli-button">Verificar versión</button>
                    </a>
                    <button class="generate-summary-btn hooli-button" data-app-name="hooli" data-app-url="https://play.google.com/store/apps/details?id=net.airata.hooli.app&hl=es_AR">Generar Resumen ✨</button>
                    <button class="optimize-app-btn hooli-button optimize-button" data-app-name="hooli" data-app-url="https://play.google.com/store/apps/details?id=net.airata.hooli.app&hl=es_AR">Optimizar APP ✨</button>
                </div>
            </div>

            <!-- RN Hooli (nueva app) -->
            <div class="app-card">
                <img src="https://play-lh.googleusercontent.com/ayyGjlA-8qOiv-fBr5cKfX8mJmZx2ifbsy-BODc88VYLwmsEWRddA4bPVUaY8ZNjsg=w480-h960-rw" alt="Imagen de RN Hooli">
                <h2>RN Hooli</h2>
                <div class="button-group">
                    <a href="https://play.google.com/store/apps/details?id=net.airata.hoolisur&hl=es_AR" target="_blank">
                        <button class="rn-hooli-button">Verificar versión</button>
                    </a>
                    <button class="generate-summary-btn rn-hooli-button" data-app-name="RN Hooli" data-app-url="https://play.google.com/store/apps/details?id=net.airata.hoolisur&hl=es_AR">Generar Resumen ✨</button>
                    <button class="optimize-app-btn rn-hooli-button optimize-button" data-app-name="RN Hooli" data-app-url="https://play.google.com/store/apps/details?id=net.airata.hoolisur&hl=es_AR">Optimizar APP ✨</button>
                </div>
            </div>
        </div>

        <!-- Sección para Sugerir Nombres de APP -->
        <div class="llm-feature-section container space-y-4 mt-10">
            <h2 class="text-2xl font-bold text-gray-800 text-center mb-4">Sugerir Nombres para APPs ✨</h2>
            <p class="text-gray-700 mb-4 text-center">Introduce palabras clave (ej. "salud, bienestar, ejercicios") para generar ideas de nombres de aplicaciones.</p>
            <textarea id="keywordsInput"
                      class="w-full p-3 border border-blue-400 rounded-md focus:ring-2 focus:ring-blue-600 focus:border-blue-600 transition duration-200"
                      placeholder="Ej: Finanzas, inversión, futuro"></textarea>
            <button id="generateNamesBtn"
                    class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-opacity-50 transition duration-300 ease-in-out transform hover:scale-105 mt-4">
                Generar Nombres
            </button>
            <div id="namesResult" class="mt-4 p-4 bg-white rounded-md text-gray-800 text-left hidden">
                <h3 class="text-lg font-semibold mb-2">Nombres Sugeridos:</h3>
                <ul id="suggestedNamesList" class="list-disc list-inside"></ul>
                <div id="namesLoading" class="text-center mt-2 hidden">
                    <div class="loading-spinner inline-block"></div>
                    <span class="ml-2 text-blue-600">Generando nombres...</span>
                </div>
            </div>
            <div id="namesError" class="text-red-600 text-center font-medium mt-4 hidden"></div>
        </div>

        <!-- Sección para Generar Descripción de APP -->
        <div class="llm-feature-section container space-y-4 mt-10">
            <h2 class="text-2xl font-bold text-gray-800 text-center mb-4">Generar Descripción de APP ✨</h2>
            <p class="text-gray-700 mb-2 text-center">Ingresa el nombre de la APP y palabras clave para una descripción de la tienda de aplicaciones.</p>
            <input type="text" id="appDescriptionName"
                   class="w-full p-3 border border-purple-400 rounded-md focus:ring-2 focus:ring-purple-600 focus:border-purple-600 transition duration-200"
                   placeholder="Nombre de la APP (Ej: FitnessPro)">
            <textarea id="appDescriptionKeywords"
                      class="w-full p-3 mt-2 border border-purple-400 rounded-md focus:ring-2 focus:ring-purple-600 focus:border-purple-600 transition duration-200"
                      placeholder="Palabras clave (Ej: Ejercicios en casa, vida sana, entrenador personal)"></textarea>
            <button id="generateDescriptionBtn"
                    class="w-full bg-purple-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:bg-purple-700 focus:outline-none focus:ring-4 focus:ring-purple-500 focus:ring-opacity-50 transition duration-300 ease-in-out transform hover:scale-105 mt-4">
                Generar Descripción
            </button>
            <div id="descriptionResult" class="mt-4 p-4 bg-white rounded-md text-gray-800 text-left hidden">
                <h3 class="text-lg font-semibold mb-2">Descripción Generada:</h3>
                <p id="generatedDescriptionText"></p>
                <div id="descriptionLoading" class="text-center mt-2 hidden">
                    <div class="loading-spinner inline-block"></div>
                    <span class="ml-2 text-purple-600">Generando descripción...</span>
                </div>
            </div>
            <div id="descriptionError" class="text-red-600 text-center font-medium mt-4 hidden"></div>
        </div>

        <!-- Sección para Sugerir Ideas de Funcionalidades de APP -->
        <div class="llm-feature-section container space-y-4 mt-10">
            <h2 class="text-2xl font-bold text-gray-800 text-center mb-4">Sugerir Ideas de Funcionalidades de APP ✨</h2>
            <p class="text-gray-700 mb-4 text-center">Describe brevemente el propósito de la APP para obtener ideas de funcionalidades.</p>
            <textarea id="appConceptInput"
                      class="w-full p-3 border border-orange-400 rounded-md focus:ring-2 focus:ring-orange-600 focus:border-orange-600 transition duration-200"
                      placeholder="Ej: Una app para gestionar tareas del hogar en familia"></textarea>
            <button id="generateFeaturesBtn"
                    class="w-full bg-orange-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:bg-orange-700 focus:outline-none focus:ring-4 focus:ring-orange-500 focus:ring-opacity-50 transition duration-300 ease-in-out transform hover:scale-105 mt-4">
                Generar Funcionalidades
            </button>
            <div id="featuresResult" class="mt-4 p-4 bg-white rounded-md text-gray-800 text-left hidden">
                <h3 class="text-lg font-semibold mb-2">Funcionalidades Sugeridas:</h3>
                <ul id="suggestedFeaturesList" class="list-disc list-inside"></ul>
                <div id="featuresLoading" class="text-center mt-2 hidden">
                    <div class="loading-spinner inline-block"></div>
                    <span class="ml-2 text-orange-600">Generando funcionalidades...</span>
                </div>
            </div>
            <div id="featuresError" class="text-red-600 text-center font-medium mt-4 hidden"></div>
        </div>

        <!-- Botón para volver al menú principal -->
        <button id="back-to-menu-from-versions" class="bg-gray-500 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:bg-gray-600 transition duration-300 ease-in-out transform hover:scale-105 mt-10">
            ← Volver al Menú Principal
        </button>
    </div>

    <!-- Sección 2: Comparador de Totales NOSIS (Inicialmente oculta) -->
    <div id="nosis-calculator-section" class="content-section nosis-calculator-section">
        <div class="container space-y-6">
            <h1>Comparador de Totales NOSIS</h1>

            <div class="input-section bg-blue-50 p-6 rounded-lg shadow-inner">
                <h2 class="text-xl font-semibold text-blue-800 mb-4">Paso 1: Introduce tus datos de la columna "NOSIS"</h2>
                <p class="text-gray-700 mb-3">
                    Copia y pega aquí todos los números de tu columna **NOSIS**. Puedes separarlos con un salto de línea (Enter).
                </p>
                <textarea id="nosisData"
                          class="w-full p-3 border border-blue-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200"
                          placeholder="Ejemplo:
431
1312
900
..."></textarea>
            </div>

            <div class="input-section bg-green-50 p-6 rounded-lg shadow-inner">
                <h2 class="text-xl font-semibold text-green-800 mb-4">Paso 2: Introduce el valor de "NOSIS Correo" a comparar</h2>
                <p class="text-gray-700 mb-3">
                    Escribe aquí el único número de **NOSIS_Correo** que quieres comparar con el total de arriba.
                </p>
                <input type="number" id="nosisCorreo"
                       class="w-full p-3 border border-green-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500 transition duration-200"
                       placeholder="Ejemplo: 3383" step="any">
            </div>

            <button id="calculateBtn"
                    class="w-full bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:bg-indigo-700 focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50 transition duration-300 ease-in-out transform hover:scale-105">
                Calcular Porcentajes de Diferencia
            </button>

            <div id="resultsSection" class="results-section bg-gray-100 p-6 rounded-lg shadow-md space-y-4 hidden">
                <h2 class="text-xl font-semibold text-gray-800 mb-4 text-center">Resultados de la Comparación</h2>
                <div class="flex flex-col md:flex-row justify-around items-center space-y-4 md:space-y-0 md:space-x-6">
                    <div class="result-box bg-purple-100 p-5 rounded-lg text-center shadow-sm w-full md:w-1/4">
                        <p class="text-lg text-purple-700">Suma Total de NOSIS:</p>
                        <p id="sumNosis" class="text-3xl font-extrabold text-purple-900 mt-1">0</p>
                    </div>
                    <div class="result-box bg-blue-100 p-5 rounded-lg text-center shadow-sm w-full md:w-1/4">
                        <p class="text-lg text-blue-700">Diferencia Numérica:</p>
                        <p id="diffValue" class="text-3xl font-extrabold text-blue-900 mt-1">0</p>
                    </div>
                    <div class="result-box bg-yellow-100 p-5 rounded-lg text-center shadow-sm w-full md:w-1/4">
                        <p class="text-lg text-yellow-700">Porcentaje (Valor Mayor):</p>
                        <p id="percentageLarger" class="text-3xl font-extrabold text-yellow-900 mt-1">0.00%</p>
                    </div>
                     <div class="result-box bg-red-100 p-5 rounded-lg text-center shadow-sm w-full md:w-1/4">
                        <p class="text-lg text-red-700">Porcentaje (Valor Menor):</p>
                        <p id="percentageSmaller" class="text-3xl font-extrabold text-red-900 mt-1">0.00%</p>
                    </div>
                </div>
                <div class="explanation-section mt-6 p-4 bg-gray-200 rounded-md">
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">Entendiendo los Porcentajes:</h3>
                    <p class="text-gray-700 mb-2">
                        <span class="font-bold">Porcentaje (Valor Mayor):</span> Indica cuánto es más grande el número mayor con respecto al número menor (calculado sobre el número menor). Este siempre será un valor positivo.
                    </p>
                    <p class="text-gray-700">
                        <span class="font-bold">Porcentaje (Valor Menor):</span> Indica cuánto es más pequeño el número menor con respecto al número mayor (calculado sobre el número mayor). Este también será un valor positivo, representando la magnitud de la diferencia desde la perspectiva del valor mayor.
                    </p>
                </div>
                <div id="errorMessage" class="text-red-600 text-center font-medium mt-4 hidden"></div>

                <!-- Botón para el análisis LLM de NOSIS -->
                <button id="analyzeNosisBtn"
                        class="w-full bg-pink-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:bg-pink-700 focus:outline-none focus:ring-4 focus:ring-pink-500 focus:ring-opacity-50 transition duration-300 ease-in-out transform hover:scale-105 mt-6">
                    Analizar Diferencia NOSIS ✨
                </button>
                <div id="nosisAnalysisResult" class="mt-4 p-4 bg-white rounded-md text-gray-800 text-left hidden">
                    <p id="analysisText" class="text-gray-700"></p>
                    <div id="analysisLoading" class="text-center mt-2 hidden">
                        <div class="inline-block animate-spin rounded-full h-6 w-6 border-4 border-t-4 border-pink-200 border-t-pink-600"></div>
                        <span class="ml-2 text-pink-600">Generando análisis...</span>
                    </div>
                </div>
            </div>
        </div>
        <!-- Botón para volver al menú principal -->
        <button id="back-to-menu-from-nosis" class="bg-gray-500 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:bg-gray-600 transition duration-300 ease-in-out transform hover:scale-105 mt-10">
            ← Volver al Menú Principal
        </button>
    </div>

    <!-- Contenedor para el logo (footer) - se mostrará en todas las secciones -->
    <div class="logo-container">
        <h3>¡Gracias por usar nuestra herramienta!</h3>
        <p>¡Disfruta usando nuestras herramientas!</p>
        <img src="imagen/MIAid.jpeg" onerror="this.onerror=null;this.src='https://placehold.co/100x100/CCCCCC/000000?text=Logo';" alt="Imagen de pie de página" style="width: 100px; height: 100px; border-radius: 50%; margin-top: 20px;">
        <p>&copy; <span id="year"></span> 2025 Todos los derechos reservados.</p>
    </div>

    <!-- Modal para el resumen de APP y optimización -->
    <div id="appSummaryModal" class="modal">
        <div class="modal-content">
            <button id="closeModalBtn" class="modal-close-btn">&times;</button>
            <h3 class="text-2xl font-bold text-gray-800 mb-4 text-center" id="modalTitle"></h3>
            <p id="modalContentText" class="text-gray-700 text-left mb-4"></p>
            <div id="modalLoading" class="text-center mt-2 hidden">
                <div class="inline-block animate-spin rounded-full h-6 w-6 border-4 border-t-4 border-blue-200 border-t-blue-600"></div>
                <span class="ml-2 text-blue-600">Generando respuesta...</span>
            </div>
            <a id="modalAppStoreLink" href="#" target="_blank" class="w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-blue-700 transition duration-300 ease-in-out mt-4 block text-center hidden">
                Ir a Play Store
            </a>
        </div>
    </div>


    <script>
        // Función para actualizar la hora y fecha
        function updateClock() {
            var now = new Date();
            var hours = now.getHours().toString().padStart(2, '0');
            var minutes = now.getMinutes().toString().padStart(2, '0');
            var seconds = now.getSeconds().toString().padStart(2, '0');
            var date = now.toLocaleDateString('es-AR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            document.getElementById('clock').textContent = `${date} - ${hours}:${minutes}:${seconds}`;
            document.getElementById('year').textContent = now.getFullYear(); // Actualiza el año en el footer
        }

        // Función que cambia el fondo según la hora
        function cambiarFondoSegunHora() {
            var now = new Date();
            var hours = now.getHours();
            var fondo;
            var bodyElement = document.body;

            if (hours >= 6 && hours < 12) {
                fondo = "url('imagen/Amanecer.jpg')"; // Imagen de amanecer
                bodyElement.classList.remove('nighttime');
                bodyElement.classList.add('daytime');
            } else if (hours >= 12 && hours < 18) {
                fondo = "url('imagen/Dia.jpg')"; // Imagen de día
                bodyElement.classList.remove('nighttime');
                bodyElement.classList.add('daytime');
            } else if (hours >= 18 && hours < 20) {
                fondo = "url('imagen/Atardecer.jpg')"; // Imagen de atardecer
                bodyElement.classList.remove('nighttime');
                bodyElement.classList.add('daytime');
            } else {
                fondo = "url('imagen/Noche.jpg')"; // Imagen de noche
                bodyElement.classList.remove('daytime');
                bodyElement.classList.add('nighttime');
            }
            
            bodyElement.style.backgroundImage = fondo;
            bodyElement.style.backgroundSize = 'cover';
            bodyElement.style.backgroundPosition = 'center';
            bodyElement.style.backgroundRepeat = 'no-repeat';
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Inicializar reloj y fondo
            updateClock();
            setInterval(updateClock, 1000);
            cambiarFondoSegunHora();
            setInterval(cambiarFondoSegunHora, 60 * 60 * 1000); // Actualiza el fondo cada hora

            // --- Elementos de navegación ---
            const mainMenu = document.getElementById('main-menu');
            const showVersionsBtn = document.getElementById('show-versions-btn');
            const showNosisBtn = document.getElementById('show-nosis-btn');
            const appVersionsSection = document.getElementById('app-versions-section');
            const nosisCalculatorSection = document.getElementById('nosis-calculator-section');
            const backToMenuFromVersionsBtn = document.getElementById('back-to-menu-from-versions');
            const backToMenuFromNosisBtn = document.getElementById('back-to-menu-from-nosis');

            // --- Funciones de navegación ---
            function showSection(sectionToShow) {
                mainMenu.style.display = 'none';
                appVersionsSection.style.display = 'none';
                nosisCalculatorSection.style.display = 'none';
                sectionToShow.style.display = 'flex'; /* Usar flex para centrar contenido interno si aplica */
                // Ajustar el body para permitir scroll en contenido más largo
                document.body.style.overflowY = 'auto';
                document.body.style.justifyContent = 'flex-start';
                document.body.style.alignItems = 'stretch'; /* Permitir que el contenido ocupe el ancho completo */
            }

            function showMainMenu() {
                mainMenu.style.display = 'flex';
                appVersionsSection.style.display = 'none';
                nosisCalculatorSection.style.display = 'none';
                // Restablecer el body para el menú principal
                document.body.style.overflowY = 'hidden'; /* Oculta scroll si el menú es más pequeño que la vista */
                document.body.style.justifyContent = 'center';
                document.body.style.alignItems = 'center'; /* Centra el menú */
            }

            // Event Listeners para la navegación
            showVersionsBtn.addEventListener('click', () => showSection(appVersionsSection));
            showNosisBtn.addEventListener('click', () => showSection(nosisCalculatorSection));
            backToMenuFromVersionsBtn.addEventListener('click', showMainMenu);
            backToMenuFromNosisBtn.addEventListener('click', showMainMenu);

            // Mostrar el menú principal al inicio
            showMainMenu(); 

            // --- Lógica de la Calculadora NOSIS ---
            const nosisDataInput = document.getElementById('nosisData');
            const nosisCorreoInput = document.getElementById('nosisCorreo');
            const calculateBtn = document.getElementById('calculateBtn');
            const resultsSection = document.getElementById('resultsSection');
            const sumNosisDisplay = document.getElementById('sumNosis');
            const diffValueDisplay = document.getElementById('diffValue');
            const percentageLargerDisplay = document.getElementById('percentageLarger');
            const percentageSmallerDisplay = document.getElementById('percentageSmaller');
            const errorMessageDisplay = document.getElementById('errorMessage');
            const analyzeNosisBtn = document.getElementById('analyzeNosisBtn'); // Botón para análisis LLM
            const nosisAnalysisResultDiv = document.getElementById('nosisAnalysisResult');
            const analysisTextSpan = document.getElementById('analysisText');
            const analysisLoadingDiv = document.getElementById('analysisLoading');

            calculateBtn.addEventListener('click', () => {
                errorMessageDisplay.textContent = '';
                errorMessageDisplay.classList.add('hidden');
                resultsSection.classList.add('hidden');
                nosisAnalysisResultDiv.classList.add('hidden'); // Ocultar análisis previo

                const nosisValuesRaw = nosisDataInput.value.trim();
                const nosisCorreoValue = parseFloat(nosisCorreoInput.value.trim());

                if (!nosisValuesRaw) {
                    errorMessageDisplay.textContent = 'Por favor, introduce los números de la columna NOSIS.';
                    errorMessageDisplay.classList.remove('hidden');
                    return;
                }

                if (isNaN(nosisCorreoValue)) {
                    errorMessageDisplay.textContent = 'Por favor, introduce un valor numérico para NOSIS Correo.';
                    errorMessageDisplay.classList.remove('hidden');
                    return;
                    
                }

                const nosisNumbers = nosisValuesRaw.split('\n')
                                                .map(line => parseFloat(line.trim()))
                                                .filter(num => !isNaN(num));

                if (nosisNumbers.length === 0) {
                    errorMessageDisplay.textContent = 'No se encontraron números válidos en los datos de NOSIS.';
                    errorMessageDisplay.classList.remove('hidden');
                    return;
                }

                const sumNosis = nosisNumbers.reduce((acc, curr) => acc + curr, 0);

                if (sumNosis === 0 && nosisCorreoValue === 0) {
                     errorMessageDisplay.textContent = 'Ambos valores son cero, no se puede calcular el porcentaje de diferencia.';
                     errorMessageDisplay.classList.remove('hidden');
                     sumNosisDisplay.textContent = '0';
                     diffValueDisplay.textContent = '0';
                     percentageLargerDisplay.textContent = '0.00%';
                     percentageSmallerDisplay.textContent = '0.00%';
                     return;
                }
                
                const largerValue = Math.max(sumNosis, nosisCorreoValue);
                const smallerValue = Math.min(sumNosis, nosisCorreoValue);
                const difference = Math.abs(largerValue - smallerValue);

                let percentageLarger = 0;
                if (smallerValue !== 0) {
                    percentageLarger = (difference / smallerValue) * 100;
                } else if (largerValue !== 0) {
                    percentageLarger = Infinity;
                }

                let percentageSmaller = 0;
                if (largerValue !== 0) {
                    percentageSmaller = (difference / largerValue) * 100;
                } else if (smallerValue !== 0) {
                    percentageSmaller = Infinity;
                }

                sumNosisDisplay.textContent = sumNosis.toLocaleString('es-ES', { maximumFractionDigits: 2 });
                diffValueDisplay.textContent = difference.toLocaleString('es-ES', { maximumFractionDigits: 2 });
                
                percentageLargerDisplay.textContent = isFinite(percentageLarger) ?
                    percentageLarger.toLocaleString('es-ES', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + '%' : '∞%';

                percentageSmallerDisplay.textContent = isFinite(percentageSmaller) ?
                    percentageSmaller.toLocaleString('es-ES', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + '%' : '∞%';


                resultsSection.classList.remove('hidden');
            });

            // --- Lógica del LLM para Análisis de Diferencia NOSIS ---
            analyzeNosisBtn.addEventListener('click', async () => {
                const sumNosis = parseFloat(sumNosisDisplay.textContent.replace(/\./g, '').replace(/,/g, '.')); // Obtener valor numérico
                const nosisCorreoValue = parseFloat(nosisCorreoInput.value.trim());

                if (resultsSection.classList.contains('hidden') || isNaN(sumNosis) || isNaN(nosisCorreoValue)) {
                    errorMessageDisplay.textContent = 'Por favor, calcula los resultados de NOSIS primero.';
                    errorMessageDisplay.classList.remove('hidden');
                    return;
                }

                nosisAnalysisResultDiv.classList.add('hidden');
                analysisTextSpan.textContent = '';
                analysisLoadingDiv.classList.remove('hidden');

                const prompt = `La suma total de NOSIS es ${sumNosis}. El valor de NOSIS recibido por correo es ${nosisCorreoValue}. ¿Qué implica esta diferencia en un contexto de negocio? Proporciona un breve análisis en español.`;

                try {
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                    const payload = { contents: chatHistory };
                    const apiKey = ""; 
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        analysisTextSpan.textContent = text;
                    } else {
                        analysisTextSpan.textContent = 'No se pudo generar el análisis. Inténtalo de nuevo.';
                        console.error('Gemini API response structure unexpected:', result);
                    }
                } catch (error) {
                    analysisTextSpan.textContent = 'Error al conectar con la IA. Por favor, revisa tu conexión.';
                    console.error('Error calling Gemini API:', error);
                } finally {
                    analysisLoadingDiv.classList.add('hidden');
                    nosisAnalysisResultDiv.classList.remove('hidden');
                }
            });

            // --- Lógica del LLM para Generar Resumen de APP y Optimización (Modal compartido) ---
            const generateSummaryBtns = document.querySelectorAll('.generate-summary-btn');
            const optimizeAppBtns = document.querySelectorAll('.optimize-app-btn'); // Nuevos botones de optimización
            const appSummaryModal = document.getElementById('appSummaryModal');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const modalTitleSpan = document.getElementById('modalTitle'); // Usado para el título del modal
            const modalContentText = document.getElementById('modalContentText'); // Usado para el contenido del modal
            const modalAppStoreLink = document.getElementById('modalAppStoreLink');
            const modalLoadingDiv = document.getElementById('modalLoading');
            // Elementos de LLM para nombres y descripciones que NO DEBEN redeclararse aquí
            const keywordsInput = document.getElementById('keywordsInput');
            const generateNamesBtn = document.getElementById('generateNamesBtn');
            const namesResultDiv = document.getElementById('namesResult');
            const suggestedNamesList = document.getElementById('suggestedNamesList');
            const namesLoadingDiv = document.getElementById('namesLoading');
            const namesErrorDiv = document.getElementById('namesError');

            const appDescriptionNameInput = document.getElementById('appDescriptionName');
            const appDescriptionKeywordsInput = document.getElementById('appDescriptionKeywords');
            const generateDescriptionBtn = document.getElementById('generateDescriptionBtn');
            const descriptionResultDiv = document.getElementById('descriptionResult');
            const generatedDescriptionText = document.getElementById('generatedDescriptionText');
            const descriptionLoadingDiv = document.getElementById('descriptionLoading');
            const descriptionErrorDiv = document.getElementById('descriptionError');

            const appConceptInput = document.getElementById('appConceptInput');
            const generateFeaturesBtn = document.getElementById('generateFeaturesBtn');
            const featuresResultDiv = document.getElementById('featuresResult');
            const suggestedFeaturesList = document.getElementById('suggestedFeaturesList');
            const featuresLoadingDiv = document.getElementById('featuresLoading');
            const featuresErrorDiv = document.getElementById('featuresError');


            // Event listeners para Generar Resumen
            generateSummaryBtns.forEach(button => {
                button.addEventListener('click', async () => {
                    const appName = button.dataset.appName;
                    const appUrl = button.dataset.appUrl;
                    
                    modalTitleSpan.textContent = `Resumen de APP: ${appName}`;
                    modalAppStoreLink.classList.remove('hidden'); // Mostrar el enlace a la Play Store

                    modalContentText.textContent = '';
                    modalLoadingDiv.classList.remove('hidden');
                    appSummaryModal.classList.add('open');
                    modalAppStoreLink.href = appUrl;

                    const prompt = `Genera un resumen breve y conciso (máximo 50 palabras) sobre una aplicación llamada "${appName}". Enfócate en su posible propósito o funcionalidad general, asumiendo que es una aplicación móvil.`;

                    try {
                        let chatHistory = [];
                        chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                        const payload = { contents: chatHistory };
                        const apiKey = "";
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        const result = await response.json();

                        if (result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            const text = result.candidates[0].content.parts[0].text;
                            modalContentText.textContent = text;
                        } else {
                            modalContentText.textContent = 'No se pudo generar el resumen. Inténtalo de nuevo.';
                            console.error('Gemini API response structure unexpected:', result);
                        }
                    } catch (error) {
                        modalContentText.textContent = 'Error al conectar con la IA. Por favor, revisa tu conexión.';
                        console.error('Error calling Gemini API:', error);
                    } finally {
                        modalLoadingDiv.classList.add('hidden');
                    }
                });
            });

            // Event listeners para Optimizar APP
            optimizeAppBtns.forEach(button => {
                button.addEventListener('click', async () => {
                    const appName = button.dataset.appName;
                    const appUrl = button.dataset.appUrl;

                    modalTitleSpan.textContent = `Consejos de Optimización para: ${appName}`;
                    modalAppStoreLink.classList.add('hidden'); // Ocultar el enlace a la Play Store para optimización

                    modalContentText.textContent = '';
                    modalLoadingDiv.classList.remove('hidden');
                    appSummaryModal.classList.add('open');
                    // No hay necesidad de establecer modalAppStoreLink.href aquí si lo ocultamos.

                    const prompt = `Proporciona 3-5 consejos breves para optimizar una aplicación móvil genérica llamada "${appName}", enfocándote en aspectos como rendimiento, experiencia de usuario o marketing.`;

                    try {
                        let chatHistory = [];
                        chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                        const payload = { contents: chatHistory };
                        const apiKey = "";
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        const result = await response.json();

                        if (result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            const text = result.candidates[0].content.parts[0].text;
                            modalContentText.innerHTML = text.replace(/\n/g, '<br>'); // Reemplazar saltos de línea por <br>
                        } else {
                            modalContentText.textContent = 'No se pudieron generar los consejos. Inténtalo de nuevo.';
                            console.error('Gemini API response structure unexpected:', result);
                        }
                    } catch (error) {
                        modalContentText.textContent = 'Error al conectar con la IA. Por favor, revisa tu conexión.';
                        console.error('Error calling Gemini API:', error);
                    } finally {
                        modalLoadingDiv.classList.add('hidden');
                    }
                });
            });

            closeModalBtn.addEventListener('click', () => {
                appSummaryModal.classList.remove('open');
            });

            appSummaryModal.addEventListener('click', (e) => {
                if (e.target === appSummaryModal) {
                    appSummaryModal.classList.remove('open');
                }
            });

            // --- Lógica del LLM para Sugerencia de Nombres de APP ---
            generateNamesBtn.addEventListener('click', async () => {
                const keywords = keywordsInput.value.trim();
                namesResultDiv.classList.add('hidden');
                namesErrorDiv.classList.add('hidden');
                suggestedNamesList.innerHTML = '';
                namesLoadingDiv.classList.remove('hidden');

                if (!keywords) {
                    namesErrorDiv.textContent = 'Por favor, introduce al menos una palabra clave.';
                    namesErrorDiv.classList.remove('hidden');
                    namesLoadingDiv.classList.add('hidden');
                    return;
                }

                const prompt = `Genera 5 ideas de nombres creativos para una aplicación móvil basada en las siguientes palabras clave: "${keywords}". Formatea la respuesta como una lista numerada de nombres.`;

                try {
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                    const payload = { contents: chatHistory };
                    const apiKey = "";
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        const names = text.split('\n').filter(line => line.trim() !== ''); // Dividir por línea y filtrar vacíos
                        names.forEach(name => {
                            const listItem = document.createElement('li');
                            listItem.textContent = name.replace(/^\d+\.\s*/, ''); // Eliminar números de lista si la IA los puso
                            suggestedNamesList.appendChild(listItem);
                        });
                    } else {
                        namesErrorDiv.textContent = 'No se pudieron generar nombres. Inténtalo de nuevo.';
                        console.error('Gemini API response structure unexpected:', result);
                    }
                } catch (error) {
                    namesErrorDiv.textContent = 'Error al conectar con la IA. Por favor, revisa tu conexión.';
                    console.error('Error calling Gemini API:', error);
                } finally {
                    namesLoadingDiv.classList.add('hidden');
                    namesResultDiv.classList.remove('hidden');
                }
            });

            // --- Lógica del LLM para Generar Descripción de APP ---
            generateDescriptionBtn.addEventListener('click', async () => {
                const appName = appDescriptionNameInput.value.trim();
                const keywords = appDescriptionKeywordsInput.value.trim();

                descriptionResultDiv.classList.add('hidden');
                descriptionErrorDiv.classList.add('hidden');
                generatedDescriptionText.textContent = '';
                descriptionLoadingDiv.classList.remove('hidden');

                if (!appName && !keywords) {
                    descriptionErrorDiv.textContent = 'Por favor, introduce el nombre de la APP o al menos una palabra clave.';
                    descriptionErrorDiv.classList.remove('hidden');
                    descriptionLoadingDiv.classList.add('hidden');
                    return;
                }

                let prompt = `Genera una descripción corta y persuasiva (máximo 70 palabras) para una aplicación móvil.`;
                if (appName) {
                    prompt += ` El nombre de la aplicación es "${appName}".`;
                }
                if (keywords) {
                    prompt += ` Las palabras clave para el contenido son: "${keywords}".`;
                }
                prompt += ` La descripción debe estar en español.`;

                try {
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                    const payload = { contents: chatHistory };
                    const apiKey = "";
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        generatedDescriptionText.textContent = text;
                    } else {
                        generatedDescriptionText.textContent = 'No se pudo generar la descripción. Inténtalo de nuevo.';
                        console.error('Gemini API response structure unexpected:', result);
                    }
                } catch (error) {
                    descriptionErrorDiv.textContent = 'Error al conectar con la IA. Por favor, revisa tu conexión.';
                    console.error('Error calling Gemini API:', error);
                } finally {
                    descriptionLoadingDiv.classList.add('hidden');
                    descriptionResultDiv.classList.remove('hidden');
                }
            });

            // --- Lógica del LLM para Sugerir Ideas de Funcionalidades de APP ---
            generateFeaturesBtn.addEventListener('click', async () => {
                const appConcept = appConceptInput.value.trim();

                featuresResultDiv.classList.add('hidden');
                featuresErrorDiv.classList.add('hidden');
                suggestedFeaturesList.innerHTML = '';
                featuresLoadingDiv.classList.remove('hidden');

                if (!appConcept) {
                    featuresErrorDiv.textContent = 'Por favor, describe el propósito de la APP.';
                    featuresErrorDiv.classList.remove('hidden');
                    featuresLoadingDiv.classList.add('hidden');
                    return;
                }

                const prompt = `Sugiere 5 características clave e innovadoras para una aplicación móvil cuyo propósito principal es "${appConcept}". Formatea la respuesta como una lista numerada en español.`;

                try {
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                    const payload = { contents: chatHistory };
                    const apiKey = "";
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        const features = text.split('\n').filter(line => line.trim() !== ''); // Dividir por línea y filtrar vacíos
                        features.forEach(feature => {
                            const listItem = document.createElement('li');
                            listItem.textContent = feature.replace(/^\d+\.\s*/, ''); // Eliminar números de lista si la IA los puso
                            suggestedFeaturesList.appendChild(listItem);
                        });
                    } else {
                        featuresErrorDiv.textContent = 'No se pudieron generar funcionalidades. Inténtalo de nuevo.';
                        console.error('Gemini API response structure unexpected:', result);
                    }
                } catch (error) {
                    featuresErrorDiv.textContent = 'Error al conectar con la IA. Por favor, revisa tu conexión.';
                    console.error('Error calling Gemini API:', error);
                } finally {
                    featuresLoadingDiv.classList.add('hidden');
                    featuresResultDiv.classList.remove('hidden');
                }
            });
        });
    </script>
</body>
</html>
